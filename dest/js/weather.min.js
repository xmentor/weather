'use strict';(function(){function k(a){var b=new Date;return"short"!==(void 0===a?"long":a)?String(b):(new Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric",weekday:"long",month:"long",year:"numeric",hour12:!0})).format(b)}var e=function(a){this.storage=void 0===a?"_app":a};e.prototype.save=function(a){localStorage.setItem(this.storage,JSON.stringify(a))};e.prototype.load=function(){return JSON.parse(localStorage.getItem(this.storage))||[]};var f=function(a,b){this.id=b;this.addWeatherToBody(a)};
f.prototype.weatherTemplate=function(a){var b=document.createElement("div");b.classList.add("weather");b.tabIndex=0;b.dataset.id=this.id;b.innerHTML='<button class="weather__remove remove"><img src="img/close.svg" alt="Remove" class="remove__img"></button><div class="weather__location">'+a.name+", "+a.sys.country+
'</div><div class="weather__date"><time datetime="'+k()+'">'+k("short")+'</time></div><div class="weather__desc">'+
a.weather[0].main+'</div><div class="weather__present present"><div class="present__visual visual"><img src="img/weather/'+a.weather[0].icon+'.svg" alt="'+a.weather[0].description+'" class="visual__img"><div class="visual__temperature temperature"><span class="temperature__num">'+
Math.round(a.main.temp-273.15)+'</span><span class="temperature__deg">&deg;C</span></div></div><div class="present__desc desc"><div class="desc__humidity">Humidity: <span class="desc__value">'+
a.main.humidity+'%</span></div><div class="desc__wind">Wind: <span class="desc__value">'+Math.round(3.6*a.wind.speed)+' km/h</span></div><div class="desc__max-temp">Max. temperature: <span class="desc__value">'+
Math.round(a.main.temp_max-273.15)+'&deg;C</span></div><div class="desc__min-temp">Min. temperature: <span class="desc__value">'+Math.round(a.main.temp_min-273.15)+
"&deg;C</span></div></div></div>";return b};f.prototype.addWeatherToBody=function(a){document.querySelector(".main").appendChild(this.weatherTemplate(a))};var g=function(a,b){this.urlApi="http://api.openweathermap.org/data/2.5/weather";this.keyApi="44474d9d409dc4313c91127230d0a569";this.id=b;
this.getWeather(a)};g.prototype.getWeather=function(a){var b=this;a=encodeURIComponent(a);if(!window.fetch)throw Error("Sorry, your browser does not support Fetch API.");fetch(this.urlApi+"?q="+a+"&appid="+this.keyApi).then(function(a){if(!a.ok)throw Error("Ups, we have not connection :(");var b=a.headers.get("content-type");if(null===b&&-1===b.indexOf("application/json"))throw Error("We want JSON data!");return a.json()}).then(function(a){if(200!==a.cod)throw Error("Something is wrong :/ Try later.");
new f(a,b.id)}).catch(function(a){throw Error(a.message);})};var d=function(){this.storage=new e("weather2");this.initEvents();this.init()};d.prototype.init=function(){var a=this.storage.load();if(1>a.length)return!1;a.forEach(function(a){new g(a.nameCity,a.idCity)})};d.prototype.initEvents=function(){this.modalEvents();this.addWeatherEvent();this.refreshButtonEvent();this.removeWeatherEvent()};d.prototype.modalEvents=function(){var a=document.querySelector(".menu__button_add"),b=document.querySelector(".modal__close"),
c=document.querySelector(".modal");a.addEventListener("click",function(a){a.preventDefault();if(c.classList.contains("modal_open"))return!1;c.classList.add("modal_open");c.focus()});b.addEventListener("click",function(){c.classList.remove("modal_open");c.blur()});document.addEventListener("keydown",function(a){27===a.keyCode&&c.classList.contains("modal_open")&&(c.classList.remove("modal_open"),c.blur())})};d.prototype.addWeatherEvent=function(){var a=this,b=document.querySelector(".modal__form");
b.addEventListener("submit",function(c){var h=document.querySelector(".form__input_city").value,d=document.querySelector(".form__input_code").value,d=""===d?h:h+","+d,l=a.storage.load(),e=Date.now();/^([a-zA-Z\u0080-\u024F]+(?:. |-| |'))*[a-zA-Z\u0080-\u024F]*$/.test(h)&&(new g(d,e),b.parentNode.classList.remove("modal_open"),l.push({nameCity:d,idCity:e}),a.storage.save(l));c.preventDefault()})};d.prototype.refreshButtonEvent=function(){var a=this,b=document.querySelector(".menu__button_refresh"),
c=document.querySelector(".main");b.addEventListener("click",function(b){c.innerHTML="";a.init();b.preventDefault()})};d.prototype.removeWeatherEvent=function(){var a=this;document.querySelector(".main").addEventListener("click",function(b){var c=b.target,d=null;if(c.classList.contains("weather__remove"))d=c.parentNode;else if(c.classList.contains("remove__img"))d=c.parentNode.parentNode;else return!1;var c=a.storage.load(),e=Number(d.dataset.id),c=c.filter(function(a){return a.idCity!==e});d.remove();
a.storage.save(c);b.preventDefault()},!1)};new d})();
