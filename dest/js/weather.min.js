'use strict';(function(){function k(a){var b=new Date;return"short"!==(void 0===a?"long":a)?String(b):(new Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric",weekday:"long",month:"long",year:"numeric",hour12:!0})).format(b)}var e=function(a){this.storage=void 0===a?"_app":a};e.prototype.save=function(a){localStorage.setItem(this.storage,JSON.stringify(a))};e.prototype.load=function(){return JSON.parse(localStorage.getItem(this.storage))||[]};var f=function(a,b){this.id=b;this.addWeatherToBody(a)};
f.prototype.weatherTemplate=function(a){var b=document.createElement("article");b.classList.add("weather");b.tabIndex=0;b.dataset.id=this.id;b.innerHTML='<button class="weather__remove"><img src="img/close.svg" alt="Remove"></button><h2 class="weather__location">'+a.name+", "+a.sys.country+'</h2><div class="weather__date"><time datetime="'+
k()+'">'+k("short")+'</time></div><div class="weather__description">'+a.weather[0].main+'</div><div class="weather__row"><div class="weather__information information"><img src="img/weather/'+
a.weather[0].icon+'.svg" alt="" width="100"><div class="information__temperature temperature"><span class="temperature__value">'+Math.round(a.main.temp-273.15)+'</span><span class="temperature__deg">&deg;C<span class="visuallyhidden">elsius</span></span></div></div><dl class="weather__details details"><div class="details__row"><dt class="details__label">Humidity</dt><dd class="details__value">'+
a.main.humidity+'%</dd></div><div class="details__row"><dt class="details__label">Wind</dt><dd class="details__value">'+
Math.round(3.6*a.wind.speed)+' km/h</dd></div><div class="details__row"><dt class="details__label"><abbr title="Maximum">Max.</abbr> temperature</dt><dd class="details__value">'+
Math.round(a.main.temp_max-273.15)+'&deg;C<span class="visuallyhidden">elsius</span></dd></div><div class="details__row"><dt class="details__label"><abbr title="Minimum">Min.</abbr> temperature</dt><dd class="details__value">'+
Math.round(a.main.temp_min-273.15)+'&deg;C<span class="visuallyhidden">elsius</span></dd></div></dl></div>';return b};f.prototype.addWeatherToBody=function(a){document.querySelector(".main").appendChild(this.weatherTemplate(a))};var h=function(a,b){this.urlApi="http://api.openweathermap.org/data/2.5/weather";
this.keyApi="44474d9d409dc4313c91127230d0a569";this.id=b;this.getWeather(a)};h.prototype.getWeather=function(a){var b=this;a=encodeURIComponent(a);if(!window.fetch)throw Error("Sorry, your browser does not support Fetch API.");fetch(this.urlApi+"?q="+a+"&appid="+this.keyApi).then(function(a){if(!a.ok)throw Error("Ups, we have not connection :(");var b=a.headers.get("content-type");if(null===b&&-1===b.indexOf("application/json"))throw Error("We want JSON data!");return a.json()}).then(function(a){if(200!==
a.cod)throw Error("Something is wrong :/ Try later.");new f(a,b.id)}).catch(function(a){throw Error(a.message);})};var d=function(){this.storage=new e("weather2");this.initEvents();this.init()};d.prototype.init=function(){var a=this.storage.load();if(1>a.length)return!1;a.forEach(function(a){new h(a.nameCity,a.idCity)})};d.prototype.initEvents=function(){this.modalEvents();this.addWeatherEvent();this.refreshButtonEvent();this.removeWeatherEvent()};d.prototype.modalEvents=function(){var a=document.querySelector(".menu__button_add"),
b=document.querySelector(".modal__close"),c=document.querySelector(".modal");a.addEventListener("click",function(){if(c.classList.contains("modal_open"))return!1;c.classList.add("modal_open");c.focus()});b.addEventListener("click",function(){c.classList.remove("modal_open");c.blur()});document.addEventListener("keydown",function(a){27===a.keyCode&&c.classList.contains("modal_open")&&(c.classList.remove("modal_open"),c.blur())})};d.prototype.addWeatherEvent=function(){var a=this,b=document.querySelector(".modal__form");
b.addEventListener("submit",function(c){var d=document.querySelector(".form__input_city").value,g=document.querySelector(".form__input_code").value,g=""===g?d:d+","+g,e=a.storage.load(),f=Date.now();/^([a-zA-Z\u0080-\u024F]+(?:. |-| |'))*[a-zA-Z\u0080-\u024F]*$/.test(d)&&(new h(g,f),b.parentNode.classList.remove("modal_open"),e.push({nameCity:g,idCity:f}),a.storage.save(e));c.preventDefault()})};d.prototype.refreshButtonEvent=function(){var a=this,b=document.querySelector(".menu__button_refresh"),
c=document.querySelector(".main");b.addEventListener("click",function(){c.innerHTML="";a.init()})};d.prototype.removeWeatherEvent=function(){var a=this;document.querySelector(".main").addEventListener("click",function(b){var c=b.target;b=null;if(c.classList.contains("weather__remove"))b=c.parentNode;else if(c.classList.contains("remove__img"))b=c.parentNode.parentNode;else return!1;var c=a.storage.load(),d=Number(b.dataset.id),c=c.filter(function(a){return a.idCity!==d});b.remove();a.storage.save(c)},
!1)};new d})();
